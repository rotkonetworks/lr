<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ledger Recovery - Online</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      background: #000;
      color: #0f0;
      font-family: 'Courier New', monospace;
      padding: 20px;
    }
    h1 { color: #0f0; margin-bottom: 20px; font-size: 24px; }
    .section {
      background: #111;
      border: 2px solid #0f0;
      padding: 20px;
      margin-bottom: 20px;
    }
    p { margin: 10px 0; line-height: 1.6; }
    a { color: #0f0; }
    ol { margin-left: 20px; }
    li { margin: 10px 0; }
    iframe {
      width: 100%;
      height: 800px;
      border: 2px solid #0f0;
      background: #fff;
    }
    .warning {
      color: #f00;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>üîê Ledger Recovery - Online Transaction Builder</h1>

  <div class="section">
    <h2 style="color: #0a0; margin-bottom: 15px;">Workflow</h2>
    <ol>
      <li>Build your transaction below using PAPI Console</li>
      <li>Click "Export for Offline Signing" button (if available)</li>
      <li>Copy the JSON payload</li>
      <li>Take payload to offline device ‚Üí <a href="index.html">index.html</a></li>
      <li>Sign with your mnemonic</li>
      <li>Bring signature back online and submit</li>
    </ol>
    <p class="warning">‚ö†Ô∏è This page requires internet connection</p>
  </div>

  <div class="section">
    <h2 style="color: #0a0; margin-bottom: 15px;">PAPI Console (Extrinsic Builder)</h2>
    <p>Make sure you started: <code style="color: #0f0;">cd ../papi-console && npm run dev</code></p>
    <iframe id="papi" src="http://localhost:5173/extrinsics" title="PAPI Extrinsic Builder"></iframe>
  </div>

  <div class="section">
    <h2 style="color: #0a0; margin-bottom: 15px;">Export Payload</h2>
    <button style="background: #0a0; color: #000; border: none; padding: 12px 24px; font-size: 14px; font-weight: bold; cursor: pointer;" onclick="extractPayload()">
      üì§ Extract Payload from PAPI
    </button>
    <div id="payloadOutput" style="background: #001100; border: 1px solid #0a0; padding: 15px; margin-top: 10px; word-break: break-all; font-size: 12px; display: none;"></div>
    <button id="copyBtn" style="background: #0a0; color: #000; border: none; padding: 12px 24px; font-size: 14px; font-weight: bold; cursor: pointer; display: none; margin-top: 10px;" onclick="copyPayload()">
      üìã Copy JSON
    </button>
  </div>

  <script>
    function extractPayload() {
      try {
        const iframe = document.getElementById('papi');
        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;

        // Try to extract from your modified papi-console
        // This will depend on how you export the payload
        // For now, show a placeholder
        const payload = {
          message: "TODO: Extract payload from iframe",
          instructions: "Click 'Export for Offline Signing' in PAPI above, it will show QR/JSON"
        };

        document.getElementById('payloadOutput').textContent = JSON.stringify(payload, null, 2);
        document.getElementById('payloadOutput').style.display = 'block';
        document.getElementById('copyBtn').style.display = 'inline-block';
      } catch (e) {
        alert('Error accessing iframe: ' + e.message + '\nMake sure papi-console is running on localhost:5173');
      }
    }

    function copyPayload() {
      const payload = document.getElementById('payloadOutput').textContent;
      navigator.clipboard.writeText(payload);
      alert('Payload copied to clipboard!');
    }
  </script>
</body>
</html>
